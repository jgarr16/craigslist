<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Craigslist Washer & Dryer Gallery</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="my-favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="my-favicon/favicon.svg" />
    <link rel="shortcut icon" href="my-favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="my-favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Fauxlist" />
    <link rel="manifest" href="my-favicon/site.webmanifest" />
</head>
<body>
    <header>
        <h1>Fauxlist</h1>
    </header>

    <main>
        <div class="filter-buttons">
            <!-- Buttons will be dynamically generated -->
        </div>

        <div class="notes-section" style="display: none;">
            <div class="notes-container">
                <h2 class="notes-title"></h2>
                <div class="notes-controls">
                    <button class="notes-edit-btn">Edit Notes</button>
                    <button class="notes-save-btn" style="display: none;">Save</button>
                    <button class="notes-cancel-btn" style="display: none;">Cancel</button>
                </div>
                <div class="notes-display"></div>
                <textarea class="notes-textarea" style="display: none;" placeholder="Add notes about this category..."></textarea>
            </div>
        </div>

        <div class="gallery">
            <!-- Gallery items will be dynamically generated from gallery-data.json -->
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Fauxlist Gallery</p>
    </footer>

    <script>
        // Load gallery data and dynamically generate everything
        const galleryContainer = document.querySelector('.gallery');
        const filterButtonsContainer = document.querySelector('.filter-buttons');
        let allGalleryItems = [];

        // Notes functionality
        const notesSection = document.querySelector('.notes-section');
        const notesTitle = document.querySelector('.notes-title');
        const notesDisplay = document.querySelector('.notes-display');
        const notesTextarea = document.querySelector('.notes-textarea');
        const notesEditBtn = document.querySelector('.notes-edit-btn');
        const notesSaveBtn = document.querySelector('.notes-save-btn');
        const notesCancelBtn = document.querySelector('.notes-cancel-btn');
        let categoryNotes = {};
        let currentCategory = null;

        // Load notes from localStorage
        const loadNotes = () => {
            const savedNotes = localStorage.getItem('categoryNotes');
            if (savedNotes) {
                categoryNotes = JSON.parse(savedNotes);
            }
        };

        // Save notes to localStorage
        const saveNotes = () => {
            localStorage.setItem('categoryNotes', JSON.stringify(categoryNotes));
        };

        // Display notes for current category
        const displayNotes = (category) => {
            currentCategory = category;
            if (category === 'all') {
                notesSection.style.display = 'none';
                return;
            }

            notesSection.style.display = 'block';
            const displayName = category.split('_').map(word =>
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
            notesTitle.textContent = `${displayName} Notes`;

            const notes = categoryNotes[category] || '';
            if (notes) {
                notesDisplay.innerHTML = notes.replace(/\n/g, '<br>');
                notesDisplay.style.display = 'block';
            } else {
                notesDisplay.innerHTML = '<em>No notes yet. Click "Edit Notes" to add some.</em>';
                notesDisplay.style.display = 'block';
            }
            notesTextarea.style.display = 'none';
            notesEditBtn.style.display = 'inline-block';
            notesSaveBtn.style.display = 'none';
            notesCancelBtn.style.display = 'none';
        };

        // Edit notes
        notesEditBtn.addEventListener('click', () => {
            const notes = categoryNotes[currentCategory] || '';
            notesTextarea.value = notes;
            notesDisplay.style.display = 'none';
            notesTextarea.style.display = 'block';
            notesEditBtn.style.display = 'none';
            notesSaveBtn.style.display = 'inline-block';
            notesCancelBtn.style.display = 'inline-block';
            notesTextarea.focus();
        });

        // Save notes
        notesSaveBtn.addEventListener('click', () => {
            categoryNotes[currentCategory] = notesTextarea.value;
            saveNotes();
            displayNotes(currentCategory);
        });

        // Cancel edit
        notesCancelBtn.addEventListener('click', () => {
            displayNotes(currentCategory);
        });

        // Load notes on startup
        loadNotes();

        // Fetch gallery data
        fetch('gallery-data.json')
            .then(response => response.json())
            .then(galleryData => {
                // Generate gallery items
                galleryData.forEach(item => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item show';
                    galleryItem.setAttribute('data-category', item.category);

                    const img = document.createElement('img');
                    img.src = `images/${item.filename}?v=${Date.now()}`;
                    img.alt = item.alt;

                    galleryItem.appendChild(img);
                    galleryContainer.appendChild(galleryItem);
                });

                allGalleryItems = document.querySelectorAll('.gallery-item');

                // Get unique categories
                const categories = new Set();
                galleryData.forEach(item => {
                    categories.add(item.category);
                });

                // Create "All" button
                const allButton = document.createElement('button');
                allButton.className = 'filter-btn active';
                allButton.setAttribute('data-filter', 'all');
                allButton.textContent = 'All';
                filterButtonsContainer.appendChild(allButton);

                // Create buttons for each category
                categories.forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-filter', category);
                    // Convert "washer_dryer" to "Washer Dryer" for display
                    button.textContent = category.split('_').map(word =>
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    filterButtonsContainer.appendChild(button);
                });

                // Set up filter functionality
                const filterButtons = document.querySelectorAll('.filter-btn');

                const applyFilter = (filterValue, updateUrl = true) => {
                    // Update active button
                    filterButtons.forEach(btn => {
                        if (btn.getAttribute('data-filter') === filterValue) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });

                    // Filter gallery items
                    allGalleryItems.forEach(item => {
                        const category = item.getAttribute('data-category');

                        if (filterValue === 'all' || category === filterValue) {
                            item.style.display = 'block';
                            setTimeout(() => item.classList.add('show'), 10);
                        } else {
                            item.classList.remove('show');
                            setTimeout(() => item.style.display = 'none', 300);
                        }
                    });

                    // Update URL hash for shareable links
                    if (updateUrl) {
                        if (filterValue === 'all') {
                            history.pushState(null, null, '#all');
                        } else {
                            history.pushState(null, null, `#${filterValue}`);
                        }
                    }

                    // Display notes for the selected category
                    displayNotes(filterValue);

                    // Scroll to top smoothly
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };

                filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const filterValue = button.getAttribute('data-filter');
                        applyFilter(filterValue);
                    });
                });

                // Make gallery items clickable to filter by category
                allGalleryItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const category = item.getAttribute('data-category');
                        applyFilter(category);
                    });
                });

                // Handle browser back/forward buttons
                window.addEventListener('hashchange', () => {
                    const hash = window.location.hash.substring(1); // Remove the #
                    const filterValue = hash || 'all';
                    applyFilter(filterValue, false); // Don't update URL since we're responding to URL change
                });

                // Apply filter based on URL hash on page load
                const initialHash = window.location.hash.substring(1);
                if (initialHash && initialHash !== 'all') {
                    // Check if the hash matches a valid category
                    const validCategories = Array.from(categories);
                    if (validCategories.includes(initialHash)) {
                        applyFilter(initialHash, false);
                    } else {
                        applyFilter('all', false);
                    }
                } else {
                    applyFilter('all', false);
                }
            })
            .catch(error => {
                console.error('Error loading gallery data:', error);
                galleryContainer.innerHTML = '<p style="text-align: center; padding: 2rem;">Error loading gallery. Please run generate-gallery.js script.</p>';
            });
    </script>
</body>
</html>
